From af369db4d3833272b8ed443f7fcc2e757a0872eb Mon Sep 17 00:00:00 2001
From: Daniel Stenberg <daniel@haxx.se>
Date: Fri, 10 Mar 2023 08:22:51 +0100
Subject: [PATCH] url: fix the SSH connection reuse check

Reported-by: Harry Sintonen
Closes #10735

Backported to Debian by Samuel Henrique <samueloph@debian.org>
---
 lib/url.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: curl/lib/url.c
===================================================================
--- curl.orig/lib/url.c
+++ curl/lib/url.c
@@ -1311,8 +1311,8 @@ ConnectionExists(struct Curl_easy *data,
         }
       }
 
-      if(get_protocol_family(needle->handler->protocol) == CURLPROTO_SCP ||
-              get_protocol_family(needle->handler->protocol) == CURLPROTO_SFTP) {
+      if(get_protocol_family(needle->handler->protocol) & CURLPROTO_SCP ||
+              get_protocol_family(needle->handler->protocol) & CURLPROTO_SFTP) {
 
         if(!ssh_config_matches(needle, check))
           continue;
