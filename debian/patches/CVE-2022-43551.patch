From: Samuel Henrique <samueloph@debian.org>
Date: Tue, 27 Dec 2022 00:05:50 +0000
Subject: http: use the IDN decoded name in HSTS checks (CVE-2022-43551)

Origin: https://github.com/curl/curl/commit/9e71901634e276dd050481c4320f046bebb1bc28
---
 lib/http.c | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: curl/lib/http.c
===================================================================
--- curl.orig/lib/http.c
+++ curl/lib/http.c
@@ -4015,7 +4015,7 @@ CURLcode Curl_http_readwrite_headers(str
     else if(data->hsts && checkprefix("Strict-Transport-Security:", headp) &&
             (conn->handler->flags & PROTOPT_SSL)) {
       CURLcode check =
-        Curl_hsts_parse(data->hsts, data->state.up.hostname,
+        Curl_hsts_parse(data->hsts, conn->host.name,
                         &headp[ sizeof("Strict-Transport-Security:") -1 ]);
       if(check)
         infof(data, "Illegal STS header skipped\n");
